// test_local_database.glm
// Copyright (C) 2020 Regents of the Leland Stanford Junior University

#set savefile=gridlabd.json

#option profile

clock 
{
	timezone "US/CA/San Francisco";
	starttime "2020-01-01 00:00:00 PST";
	stoptime "2020-01-02 00:00:00 PST";
}

module influxdb
{
	default_database "test_local_database";
}

object database
{
	name "primary";
	logname "log";

	// single dynamic tag
	logtag `mytag=test1,guid={GUID},database`;

	options NEWDB;
}

object database
{
	name "secondary";
	logname "log";

	// multiple dynamic tags
	logtag "username";
	logtag `mytag=test2,tag2=abc,hostname,guid={GUID}`;
}

module residential;
object house:..10
{
	// just something to keep the clock running
	object recorder
	{
		connection "primary";
		property "air_temperature,panel.power";
		interval 1 min;
		options UNITS;
	};
	object recorder
	{
		connection "secondary";
		property "panel.energy";
		tags `id=meter_{id}`;
		interval 1 h;
		table "metering";
		options UNITS;
	};
}

// only clean if running in validation folder (useful for developers who run this model from autotest)
#ifexist ../test_local_database.glm
#on_exit 0 curl -s -XPOST 'http://${influxdb::default_hostname}:${influxdb::default_port}/query' --data 'q=drop+database+${influxdb::default_database}'  >/dev/null
#endif