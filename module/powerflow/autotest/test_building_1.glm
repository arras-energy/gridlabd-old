// module/powerflow/autotest/test_building.glm

//#set debug=TRUE

//#option profile

#define CITY=Yakima WA

#set randomseed=1

module powerflow
{
	message_flags DEBUG;
#ifexist ../data/building_defaults.csv
	building_defaults "../data/building_defaults.csv";
#endif
#ifexist ../data/building_loadshapes.csv
	building_loadshapes "../data/building_loadshapes.csv";
#endif
#ifexist ../data/building_occupancy.csv
	building_occupancy "../data/building_occupancy.csv";
#endif
}
module tape
{
	csv_header_type NAME;
}
clock
{
	timezone "PST+8PDT";
	starttime "2020-01-01 00:00:00 PST";
	stoptime "2021-01-01 00:00:00 PST";
}
#weather get WA-Yakima_Air_Terminal.tmy3
#input "WA-Yakima_Air_Terminal.tmy3" --property=name=weather

schedule setpoint
{
	* 7-17 * * 1-5 22.0;
	* 18-6 * 10-4 1-5 18.0;
	* 18-6 * 5-9 1-5 24.0;
	* * * 10-4 6-0 18.0;
	* * * 5-9 6-0 24.0; 
}

object building
{
	phases AN;
	nominal_voltage 240;
	building_type SMALLOFFICE;

	// inputs
	NH random.triangle(0,4) unit;
	floor_area 150 m^2;
	TA setpoint;

	temperature_source "weather.temperature";
	solar_source "weather.solar_global";
	heating_design "weather.record.low";
	cooling_design "weather.record.high";
	electrification_fraction 1.0;
	//electrification_efficiency 1.5;

	measured_demand_timestep 30day;
	object recorder 
	{
		property "measured_real_power[kW],TO,TA,QH";
		file ${modelname/.glm/.csv};
		interval 1h;
		line_units NONE;
	};
}

#set filesave_options=ALLINITIAL
#set dumpfile=gridlabd.json
#set savefile=${modelname/.glm/.json}

#ifexist "../${modelname/.glm/.csv}"
#on_exit 0 diff ../${modelname/.glm/.csv} ${modelname/.glm/.csv} > gridlabd.diff
#else
#on_exit 0 gridlabd plot -i=${modelname/.glm/.csv} --plot:y='TO,TA,measured_real_power[kW]' --plot:grid=True --plot:legend=True --show
#endif
