// module/powerflow/autotest/test_building.glm

//#set debug=TRUE

//#option profile

#define CITY=Yakima WA

#set randomseed=1
//#set suppress_repeat_messages=FALSE
#set output_message_context=NONE

module powerflow
{
	message_flags DEBUG;
#ifexist ../data/building_defaults.csv
	building_defaults "../data/building_defaults.csv";
#endif
#ifexist ../data/building_loadshapes.csv
	building_loadshapes "../data/building_loadshapes.csv";
#endif
}
module tape
{
	csv_header_type NAME;
}
clock
{
	timezone "PST+8PDT";
	starttime "2020-01-01 00:00:00 PST";
	stoptime "2021-01-01 00:00:00 PST";
}
#weather get WA-Yakima_Air_Terminal.tmy3
#input "WA-Yakima_Air_Terminal.tmy3" --property=name=weather

object building
{
	phases AN;
	nominal_voltage 240;
	building_type SMALLOFFICE;

	// inputs
	EU random.triangle(0.1,0.2) unit;
	NG random.triangle(0.1,0.2) unit;
	NH random.triangle(0,4) unit;

	temperature_source "weather.temperature";
	solar_source "weather.solar_global";
	heating_design "weather.record.low";
	cooling_design "weather.record.high";

	measured_demand_timestep 1wk;
	object recorder 
	{
		property "measured_real_power[kW],TO,TA,QH";
		file ${modelname/.glm/.csv};
		interval 1h;
		line_units NONE;
	};
}

#set filesave_options=ALLINITIAL
#set dumpfile=gridlabd.json
#set savefile=${modelname/.glm/.json}

#ifexist "../${modelname/.glm/.csv}"
#on_exit 0 diff ../${modelname/.glm/.csv} ${modelname/.glm/.csv} > gridlabd.diff
#else
#on_exit 0 gridlabd plot -i=${modelname/.glm/.csv} --plot:y='measured_real_power[kW],TO,TA' --plot:grid=True --show
#endif
