//This will test compares the total_power to hvac_load to ensure consistency of units in house_e.cpp 
// Author: aivanova@slac.stanford.edu
#set minimum_timestep=1;

module residential{
	implicit_enduses NONE;
}
module tape;
module assert;
module climate;
module powerflow;

clock{
	timezone PST+8PDT;
	starttime '2001-05-5 05:00:00';
	stoptime '2001-05-6 05:00:00';
}


object climate{
	name climate;
	tmyfile "../WA-Yakima.tmy3";
}

schedule heatspt{
	* * * * * 70;
}

schedule coolspt{
	* * * * * 90;
}

schedule waterheater_demand_prob {
	* 5-21 * * * 0.99;
	* 22-4 * * * 0.01;
}

class waterheater{
	loadshape wh_shape;
}

object triplex_meter{
	nominal_voltage 120;
	phases AS;
	object house{
		system_mode OFF;
		auxiliary_strategy DEADBAND;
		heating_system_type HEAT_PUMP;
		cooling_system_type ELECTRIC;
		air_temperature 61.8;
		mass_temperature 62.2;
		heating_setpoint heatspt*1;
		cooling_setpoint coolspt*1;
		object waterheater {
			wh_shape "type: pulsed; schedule: waterheater_demand_prob; energy: 7.2 kWh; count: 6; power: 300 W";
			tank_setpoint 140;
			water_demand this.wh_shape*0.115; //scaling issue with loadshape/schedules 
			heating_element_capacity 4500 W;
			tank_volume 80 gal;
		};
		object recorder{
			property total_power[kVA], hvac_load[kVA], hvac_power[kVA], system_mode;
			file "test_total_power.csv";
			interval -1;
		};
	};
}

script on_term "python3 ../test_total_power.py";